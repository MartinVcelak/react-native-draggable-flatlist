{"version":3,"names":["React","useRef","useState","findNodeHandle","LogBox","useDerivedValue","useSharedValue","DraggableFlatList","useSafeNestableScrollContainerContext","useNestedAutoScroll","useStableCallback","NestableDraggableFlatListInner","props","ref","hasSuppressedWarnings","current","ignoreLogs","console","reportErrorsAsExceptions","scrollableRef","outerScrollOffset","setOuterScrollEnabled","listVerticalOffset","animVals","setAnimVals","defaultHoverOffset","listHoverOffset","setListHoverOffset","hoverOffset","value","onListContainerLayout","containerRef","nodeHandle","onSuccess","_x","y","onFail","log","measureLayout","onDragBegin","params","_props$onDragBegin","call","onDragEnd","_props$onDragEnd","onAnimValInit","_props$onAnimValInit","createElement","_extends","onContainerLayout","activationDistance","scrollEnabled","NestableDraggableFlatList","forwardRef"],"sources":["NestableDraggableFlatList.tsx"],"sourcesContent":["import React, { useRef, useState } from \"react\";\nimport { findNodeHandle, LogBox } from \"react-native\";\nimport Animated, {\n  useDerivedValue,\n  useSharedValue,\n} from \"react-native-reanimated\";\nimport { DraggableFlatListProps } from \"../types\";\nimport DraggableFlatList from \"../components/DraggableFlatList\";\nimport { useSafeNestableScrollContainerContext } from \"../context/nestableScrollContainerContext\";\nimport { useNestedAutoScroll } from \"../hooks/useNestedAutoScroll\";\nimport { typedMemo } from \"../utils\";\nimport { useStableCallback } from \"../hooks/useStableCallback\";\nimport { FlatList } from \"react-native-gesture-handler\";\n\nfunction NestableDraggableFlatListInner<T>(\n  props: DraggableFlatListProps<T>,\n  ref?: React.ForwardedRef<FlatList<T>>\n) {\n  const hasSuppressedWarnings = useRef(false);\n\n  if (!hasSuppressedWarnings.current) {\n    LogBox.ignoreLogs([\n      \"VirtualizedLists should never be nested inside plain ScrollViews with the same orientation because it can break windowing\",\n    ]); // Ignore log notification by message\n    //@ts-ignore\n    console.reportErrorsAsExceptions = false;\n    hasSuppressedWarnings.current = true;\n  }\n\n  const {\n    scrollableRef,\n    outerScrollOffset,\n    setOuterScrollEnabled,\n  } = useSafeNestableScrollContainerContext();\n\n  const listVerticalOffset = useSharedValue(0);\n  const [animVals, setAnimVals] = useState({});\n  const defaultHoverOffset = useSharedValue(0);\n  const [listHoverOffset, setListHoverOffset] = useState(defaultHoverOffset);\n\n  const hoverOffset = useDerivedValue(() => {\n    return listHoverOffset.value + listVerticalOffset.value;\n  }, [listHoverOffset]);\n\n  useNestedAutoScroll({\n    ...animVals,\n    hoverOffset,\n  });\n\n  const onListContainerLayout = useStableCallback(async ({ containerRef }) => {\n    const nodeHandle = findNodeHandle(scrollableRef.current);\n\n    const onSuccess = (_x: number, y: number) => {\n      listVerticalOffset.value = y;\n    };\n    const onFail = () => {\n      console.log(\"## nested draggable list measure fail\");\n    };\n    //@ts-ignore\n    containerRef.current.measureLayout(nodeHandle, onSuccess, onFail);\n  });\n\n  const onDragBegin: DraggableFlatListProps<T>[\"onDragBegin\"] = useStableCallback(\n    (params) => {\n      setOuterScrollEnabled(false);\n      props.onDragBegin?.(params);\n    }\n  );\n\n  const onDragEnd: DraggableFlatListProps<T>[\"onDragEnd\"] = useStableCallback(\n    (params) => {\n      setOuterScrollEnabled(true);\n      props.onDragEnd?.(params);\n    }\n  );\n\n  const onAnimValInit: DraggableFlatListProps<T>[\"onAnimValInit\"] = useStableCallback(\n    (params) => {\n      setListHoverOffset(params.hoverOffset);\n      setAnimVals({\n        ...params,\n        hoverOffset,\n      });\n      props.onAnimValInit?.(params);\n    }\n  );\n\n  return (\n    <DraggableFlatList\n      ref={ref}\n      onContainerLayout={onListContainerLayout}\n      activationDistance={props.activationDistance || 20}\n      scrollEnabled={false}\n      {...props}\n      outerScrollOffset={outerScrollOffset}\n      onDragBegin={onDragBegin}\n      onDragEnd={onDragEnd}\n      onAnimValInit={onAnimValInit}\n    />\n  );\n}\n\n// Generic forwarded ref type assertion taken from:\n// https://fettblog.eu/typescript-react-generic-forward-refs/#option-1%3A-type-assertion\nexport const NestableDraggableFlatList = React.forwardRef(\n  NestableDraggableFlatListInner\n) as <T>(\n  props: DraggableFlatListProps<T> & { ref?: React.ForwardedRef<FlatList<T>> }\n) => ReturnType<typeof NestableDraggableFlatListInner>;\n"],"mappings":"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","ignoreList":[]}