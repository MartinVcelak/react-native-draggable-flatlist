{"version":3,"names":["_react","_interopRequireWildcard","require","_reactNative","_reactNativeReanimated","_DraggableFlatList","_interopRequireDefault","_nestableScrollContainerContext","_useNestedAutoScroll","_useStableCallback","_jsxFileName","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","NestableDraggableFlatListInner","props","ref","hasSuppressedWarnings","useRef","current","LogBox","ignoreLogs","console","reportErrorsAsExceptions","_useSafeNestableScrol","useSafeNestableScrollContainerContext","scrollableRef","outerScrollOffset","setOuterScrollEnabled","listVerticalOffset","useSharedValue","_useState","useState","_useState2","_slicedToArray2","animVals","setAnimVals","defaultHoverOffset","_useState3","_useState4","listHoverOffset","setListHoverOffset","hoverOffset","useDerivedValue","_f","value","_closure","asString","__workletHash","__location","useNestedAutoScroll","assign","onListContainerLayout","useStableCallback","_ref2","_asyncToGenerator2","_ref","containerRef","nodeHandle","findNodeHandle","onSuccess","_x","y","onFail","log","measureLayout","_x2","apply","arguments","onDragBegin","params","onDragEnd","onAnimValInit","createElement","_extends2","onContainerLayout","activationDistance","scrollEnabled","__self","__source","fileName","lineNumber","columnNumber","NestableDraggableFlatList","exports","React","forwardRef"],"sources":["NestableDraggableFlatList.tsx"],"sourcesContent":["import React, { useRef, useState } from \"react\";\nimport { findNodeHandle, LogBox } from \"react-native\";\nimport Animated, {\n  useDerivedValue,\n  useSharedValue,\n} from \"react-native-reanimated\";\nimport { DraggableFlatListProps } from \"../types\";\nimport DraggableFlatList from \"../components/DraggableFlatList\";\nimport { useSafeNestableScrollContainerContext } from \"../context/nestableScrollContainerContext\";\nimport { useNestedAutoScroll } from \"../hooks/useNestedAutoScroll\";\nimport { typedMemo } from \"../utils\";\nimport { useStableCallback } from \"../hooks/useStableCallback\";\nimport { FlatList } from \"react-native-gesture-handler\";\n\nfunction NestableDraggableFlatListInner<T>(\n  props: DraggableFlatListProps<T>,\n  ref?: React.ForwardedRef<FlatList<T>>\n) {\n  const hasSuppressedWarnings = useRef(false);\n\n  if (!hasSuppressedWarnings.current) {\n    LogBox.ignoreLogs([\n      \"VirtualizedLists should never be nested inside plain ScrollViews with the same orientation because it can break windowing\",\n    ]); // Ignore log notification by message\n    //@ts-ignore\n    console.reportErrorsAsExceptions = false;\n    hasSuppressedWarnings.current = true;\n  }\n\n  const {\n    scrollableRef,\n    outerScrollOffset,\n    setOuterScrollEnabled,\n  } = useSafeNestableScrollContainerContext();\n\n  const listVerticalOffset = useSharedValue(0);\n  const [animVals, setAnimVals] = useState({});\n  const defaultHoverOffset = useSharedValue(0);\n  const [listHoverOffset, setListHoverOffset] = useState(defaultHoverOffset);\n\n  const hoverOffset = useDerivedValue(() => {\n    return listHoverOffset.value + listVerticalOffset.value;\n  }, [listHoverOffset]);\n\n  useNestedAutoScroll({\n    ...animVals,\n    hoverOffset,\n  });\n\n  const onListContainerLayout = useStableCallback(async ({ containerRef }) => {\n    const nodeHandle = findNodeHandle(scrollableRef.current);\n\n    const onSuccess = (_x: number, y: number) => {\n      listVerticalOffset.value = y;\n    };\n    const onFail = () => {\n      console.log(\"## nested draggable list measure fail\");\n    };\n    //@ts-ignore\n    containerRef.current.measureLayout(nodeHandle, onSuccess, onFail);\n  });\n\n  const onDragBegin: DraggableFlatListProps<T>[\"onDragBegin\"] = useStableCallback(\n    (params) => {\n      setOuterScrollEnabled(false);\n      props.onDragBegin?.(params);\n    }\n  );\n\n  const onDragEnd: DraggableFlatListProps<T>[\"onDragEnd\"] = useStableCallback(\n    (params) => {\n      setOuterScrollEnabled(true);\n      props.onDragEnd?.(params);\n    }\n  );\n\n  const onAnimValInit: DraggableFlatListProps<T>[\"onAnimValInit\"] = useStableCallback(\n    (params) => {\n      setListHoverOffset(params.hoverOffset);\n      setAnimVals({\n        ...params,\n        hoverOffset,\n      });\n      props.onAnimValInit?.(params);\n    }\n  );\n\n  return (\n    <DraggableFlatList\n      ref={ref}\n      onContainerLayout={onListContainerLayout}\n      activationDistance={props.activationDistance || 20}\n      scrollEnabled={false}\n      {...props}\n      outerScrollOffset={outerScrollOffset}\n      onDragBegin={onDragBegin}\n      onDragEnd={onDragEnd}\n      onAnimValInit={onAnimValInit}\n    />\n  );\n}\n\n// Generic forwarded ref type assertion taken from:\n// https://fettblog.eu/typescript-react-generic-forward-refs/#option-1%3A-type-assertion\nexport const NestableDraggableFlatList = React.forwardRef(\n  NestableDraggableFlatListInner\n) as <T>(\n  props: DraggableFlatListProps<T> & { ref?: React.ForwardedRef<FlatList<T>> }\n) => ReturnType<typeof NestableDraggableFlatListInner>;\n"],"mappings":"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","ignoreList":[]}