{"version":3,"names":["_react","_interopRequireWildcard","require","_reactNativeReanimated","_constants","_propsContext","_jsxFileName","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","RefContext","React","createContext","undefined","RefProvider","_ref","children","flatListRef","value","useSetupRefs","createElement","Provider","__self","__source","fileName","lineNumber","columnNumber","useRefs","useContext","Error","_ref2","flatListRefProp","props","useProps","_props$animationConfi","animationConfig","DEFAULT_PROPS","propsRef","useRef","current","animConfig","useMemo","assign","animationConfigRef","useSharedValue","useEffect","cellDataRef","Map","keyToIndexRef","containerRef","flatlistRefInternal","flatlistRef","scrollViewRef","refs"],"sources":["refContext.tsx"],"sourcesContent":["import React, { useContext, useEffect } from \"react\";\nimport { useMemo, useRef } from \"react\";\nimport { FlatList } from \"react-native-gesture-handler\";\nimport Animated, { type SharedValue, useSharedValue, WithSpringConfig } from \"react-native-reanimated\";\nimport { DEFAULT_PROPS } from \"../constants\";\nimport { useProps } from \"./propsContext\";\nimport { CellData, DraggableFlatListProps } from \"../types\";\n\ntype RefContextValue<T> = {\n  propsRef: React.MutableRefObject<DraggableFlatListProps<T>>;\n  animationConfigRef: SharedValue<WithSpringConfig>;\n  cellDataRef: React.MutableRefObject<Map<string, CellData>>;\n  keyToIndexRef: React.MutableRefObject<Map<string, number>>;\n  containerRef: React.RefObject<Animated.View>;\n  flatlistRef: React.RefObject<FlatList<T>> | React.ForwardedRef<FlatList<T>>;\n  scrollViewRef: React.RefObject<Animated.ScrollView>;\n};\nconst RefContext = React.createContext<RefContextValue<any> | undefined>(\n  undefined\n);\n\nexport default function RefProvider<T>({\n  children,\n  flatListRef,\n}: {\n  children: React.ReactNode;\n  flatListRef?: React.ForwardedRef<FlatList<T>> | null;\n}) {\n  const value = useSetupRefs<T>({ flatListRef });\n  return <RefContext.Provider value={value}>{children}</RefContext.Provider>;\n}\n\nexport function useRefs<T>() {\n  const value = useContext(RefContext);\n  if (!value) {\n    throw new Error(\n      \"useRefs must be called from within a RefContext.Provider!\"\n    );\n  }\n  return value as RefContextValue<T>;\n}\n\nfunction useSetupRefs<T>({\n  flatListRef: flatListRefProp,\n}: {\n  flatListRef?: React.ForwardedRef<FlatList<T>> | null;\n}) {\n  const props = useProps<T>();\n  const { animationConfig = DEFAULT_PROPS.animationConfig } = props;\n\n  const propsRef = useRef(props);\n  propsRef.current = props;\n  const animConfig = useMemo(\n    () => ({\n      ...DEFAULT_PROPS.animationConfig,\n      ...animationConfig,\n    } as WithSpringConfig),\n    [animationConfig]\n  );\n\n  const animationConfigRef = useSharedValue(animConfig);\n  useEffect(() => {\n    animationConfigRef.value = animConfig;\n  }, [animConfig]);\n\n  const cellDataRef = useRef(new Map<string, CellData>());\n  const keyToIndexRef = useRef(new Map<string, number>());\n  const containerRef = useRef<Animated.View>(null);\n  const flatlistRefInternal = useRef<FlatList<T>>(null);\n  const flatlistRef = flatListRefProp || flatlistRefInternal;\n  const scrollViewRef = useRef<Animated.ScrollView>(null);\n\n  // useEffect(() => {\n  //   // This is a workaround for the fact that RN does not respect refs passed in\n  //   // to renderScrollViewComponent underlying ScrollView (currently not used but\n  //   // may need to add if we want to use reanimated scrollTo in the future)\n  //   //@ts-ignore\n  //   const scrollRef = flatlistRef.current?.getNativeScrollRef();\n  //   if (!scrollViewRef.current) {\n  //     //@ts-ignore\n  //     scrollViewRef(scrollRef);\n  //   }\n  // }, []);\n\n  const refs = useMemo(\n    () => ({\n      animationConfigRef,\n      cellDataRef,\n      containerRef,\n      flatlistRef,\n      keyToIndexRef,\n      propsRef,\n      scrollViewRef,\n    }),\n    []\n  );\n\n  return refs;\n}\n"],"mappings":"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","ignoreList":[]}